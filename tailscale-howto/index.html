<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tailscale 服务部署快速参考 - libreliu&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2025&#x2F;02&#x2F;28: 修复了笔误，感谢 @taoky。  Tailscale 介绍 来源于 Kimi.ai，K1.5 Long thinking  Tailscale 是一种网状 VPN 服务，它简化了不同网络中设备和服务之间的安全连接。以下是关于它的一些关键点：  基本概念和工作原理 网状网络架构：与传统的使用中央网关的 VPN 不同，Tailscale 创建了一个点对点">
<meta property="og:type" content="article">
<meta property="og:title" content="Tailscale 服务部署快速参考">
<meta property="og:url" content="https://blog.libreliu.info/tailscale-howto/">
<meta property="og:site_name" content="libreliu&#39;s blog">
<meta property="og:description" content="2025&#x2F;02&#x2F;28: 修复了笔误，感谢 @taoky。  Tailscale 介绍 来源于 Kimi.ai，K1.5 Long thinking  Tailscale 是一种网状 VPN 服务，它简化了不同网络中设备和服务之间的安全连接。以下是关于它的一些关键点：  基本概念和工作原理 网状网络架构：与传统的使用中央网关的 VPN 不同，Tailscale 创建了一个点对点">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.libreliu.info/tailscale-howto/tailscale_login.png">
<meta property="og:image" content="https://blog.libreliu.info/tailscale-howto/tailscale_jump_page.png">
<meta property="article:published_time" content="2025-02-25T16:00:00.000Z">
<meta property="article:modified_time" content="2025-02-25T16:00:00.000Z">
<meta property="article:author" content="Libre Liu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.libreliu.info/tailscale-howto/tailscale_login.png">
  
  
    <link rel="icon" href="/css/images/logo.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="libreliu's blog" type="application/atom+xml">
</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/paper-summary">Paper Reading</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.libreliu.info"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-tailscale-howto" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Tailscale 服务部署快速参考
      <small class=article-detail-date-index>&nbsp; 2025-02-26</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/tailscale-howto/" class="article-date">
  <time datetime="2025-02-25T16:00:00.000Z" itemprop="datePublished">2025-02-26</time>
</a>-->
      <!-- 
--><!-- by blair 160724 -->
      <!-- by blair
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
      
      
        <blockquote>
<p>2025&#x2F;02&#x2F;28: 修复了笔误，感谢 @taoky。</p>
</blockquote>
<h2 id="Tailscale-介绍"><a href="#Tailscale-介绍" class="headerlink" title="Tailscale 介绍"></a>Tailscale 介绍</h2><blockquote>
<p>来源于 Kimi.ai，K1.5 Long thinking</p>
</blockquote>
<p>Tailscale 是一种网状 VPN 服务，它简化了不同网络中设备和服务之间的安全连接。以下是关于它的一些关键点：</p>
<ul>
<li>基本概念和工作原理<ul>
<li>网状网络架构：与传统的使用中央网关的 VPN 不同，Tailscale 创建了一个点对点的网状网络（称为 tailnet）。网络中的每个设备都可以直接与其他设备通信，从而降低了延迟并提高了吞吐量。</li>
<li>WireGuard 协议：它利用开源的 WireGuard 协议进行加密的点对点连接。该协议以其安全性和性能著称，提供了端到端的加密和零信任架构。</li>
</ul>
</li>
<li>优势<ul>
<li>高性能：去中心化的架构避免了单点故障和瓶颈，即使网络规模扩大，也能确保稳定可靠的连接。</li>
<li>安全性和隐私性：基于现代技术和最佳实践构建，Tailscale 提供了强大的安全功能，如访问控制策略和 tailnet 锁定。它还符合各种安全标准。</li>
<li>易于使用：Tailscale 高度可配置，但设置起来非常简单。用户无需深厚的网络知识即可在几分钟内部署一个 tailnet。“零配置”方法允许在防火墙和 NAT 之后无缝连接，无需复杂的配置。</li>
</ul>
</li>
</ul>
<h2 id="服务端部署"><a href="#服务端部署" class="headerlink" title="服务端部署"></a>服务端部署</h2><p>其实 Tailscale 可以采用官方的服务器，不过也可以使用开源的 headscale 实现，自己搭建登录服务器。</p>
<p>这里选择采用</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/juanfont/headscale">headscale</a> v0.23.0 作为登录服务器</li>
<li><a target="_blank" rel="noopener" href="https://github.com/gurucomputing/headscale-ui">headscale-ui</a> </li>
<li>Caddy 作为反向代理，把 UI 和 headscale 本身需要提供的网关功能搓到一起，同时自动获取 SSL 证书来处理 https</li>
</ul>
<p>采用 Docker Compose v3 来简单编排容器。</p>
<p>具体可以参考后面的“附录：全量服务端配置”。</p>
<p>配置文件和其余命令约定如下：</p>
<ul>
<li><code>your.example.com</code> 是用来 host Tailscale 的你的域名，其应该有正确配置的 A 和 AAAA 记录。</li>
<li><code>your_email@example.com</code> 是你的邮箱。</li>
<li><code>intra.example.com</code> 是 MagicDNS 前缀，Tailscale 网络内的客户端在连接到 Tailscale 网络后，可以通过 <code>主机名.intra.example.com</code> 解析到彼此的网内 IP 地址。这里推荐采用自己域名的子域名，这样以避免和互联网上的可能域名冲突。</li>
</ul>
<p>在按全量服务端配置配置后，需要生成 api key 用于 Headscale UI 的 Web 访问。</p>
<p>可以考虑用下面的命令生成 Key：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3650d 代表该 apikey 将在 3650 天后过期</span></span><br><span class="line">docker <span class="built_in">exec</span> -it headscale headscale apikeys create -e 3650d</span><br></pre></td></tr></table></figure>

<p>记录该 Key，并填入 Headscale UI，就可以通过浏览器管理客户端设备和用户的访问权限等。</p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>在 Tailscale 官方网站下载客户端，安装后，打开 cmd，输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailscale login --login-server http://your.example.com/</span><br></pre></td></tr></table></figure>

<p>后，点击下图的托盘提示，跳转到 Headscale 的提示页面</p>
<p><img src="/./tailscale-howto/tailscale_login.png"></p>
<p><img src="/./tailscale-howto/tailscale_jump_page.png"></p>
<p>然后打开 Headscale UI 的 Device 页面 （例如，<code>https://your.example.com/web/devices.html</code>）增加 User 后增加相应 Device 即可。</p>
<h2 id="附录：全量服务端配置"><a href="#附录：全量服务端配置" class="headerlink" title="附录：全量服务端配置"></a>附录：全量服务端配置</h2><ul>
<li><code>your.example.com</code> 是用来 host Tailscale 的你的域名，其应该有正确配置的 A 和 AAAA 记录。</li>
<li><code>your_email@example.com</code> 是你的邮箱。</li>
<li><code>intra.example.com</code> 是 MagicDNS 前缀，Tailscale 网络内的客户端在连接到 Tailscale 网络后，可以通过 <code>主机名.intra.example.com</code> 解析到彼此的网内 IP 地址。这里推荐采用自己域名的子域名，这样以避免和互联网上的可能域名冲突。</li>
</ul>
<h3 id="docker-compose-yaml"><a href="#docker-compose-yaml" class="headerlink" title="./docker-compose.yaml"></a><code>./docker-compose.yaml</code></h3><p>这里最后会暴露 80，443 两个端口。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">headscale:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">headscale/headscale:v0.23.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">headscale</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># 80 is to be forwarded by caddy, and hence not exposed</span></span><br><span class="line">           <span class="comment"># only need to expose others locally</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:9090:9090&quot;</span>  <span class="comment"># /metrics</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:50443:50443&quot;</span>  <span class="comment"># grpc api</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/libreliu/headscale/config:/etc/headscale</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">headscale_data:/var/lib/headscale</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">serve</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hs-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">headscale-ui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/gurucomputing/headscale-ui:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">headscale-ui</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8443&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hs-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">caddy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">caddy:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">caddy</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./Caddyfile:/etc/caddy/Caddyfile</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">caddy_data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">caddy_config:/config</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hs-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hs-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">caddy_data:</span></span><br><span class="line">  <span class="attr">caddy_config:</span></span><br><span class="line">  <span class="attr">headscale_data:</span></span><br></pre></td></tr></table></figure>

<h3 id="Caddyfile"><a href="#Caddyfile" class="headerlink" title="./Caddyfile"></a><code>./Caddyfile</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    email your_email@example.com  # Provide a valid email for ACME notifications.</span><br><span class="line">    admin off  # Disable Caddy&#x27;s admin API if not needed.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Route for Headscale UI</span><br><span class="line">your.example.com &#123;</span><br><span class="line">    reverse_proxy /web* http://headscale-ui:8080</span><br><span class="line">    reverse_proxy * http://headscale:80</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="config-config-yaml"><a href="#config-config-yaml" class="headerlink" title="./config/config.yaml"></a><code>./config/config.yaml</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"># headscale will look for a configuration file named `config.yaml` (or `config.json`) in the following order:</span><br><span class="line">#</span><br><span class="line"># - `/etc/headscale`</span><br><span class="line"># - `~/.headscale`</span><br><span class="line"># - current working directory</span><br><span class="line"></span><br><span class="line"># The url clients will connect to.</span><br><span class="line"># Typically this will be a domain like:</span><br><span class="line">#</span><br><span class="line"># https://myheadscale.example.com:443</span><br><span class="line">#</span><br><span class="line">server_url: https://your.example.com:443</span><br><span class="line"></span><br><span class="line"># Address to listen to / bind to on the server</span><br><span class="line">#</span><br><span class="line"># For production:</span><br><span class="line">listen_addr: 0.0.0.0:80</span><br><span class="line">#listen_addr: 127.0.0.1:8080</span><br><span class="line"></span><br><span class="line"># Address to listen to /metrics, you may want</span><br><span class="line"># to keep this endpoint private to your internal</span><br><span class="line"># network</span><br><span class="line">#</span><br><span class="line">#metrics_listen_addr: 127.0.0.1:9090</span><br><span class="line">metrics_listen_addr: 0.0.0.0:9090</span><br><span class="line"></span><br><span class="line"># Address to listen for gRPC.</span><br><span class="line"># gRPC is used for controlling a headscale server</span><br><span class="line"># remotely with the CLI</span><br><span class="line"># Note: Remote access _only_ works if you have</span><br><span class="line"># valid certificates.</span><br><span class="line">#</span><br><span class="line"># For production:</span><br><span class="line">#grpc_listen_addr: 0.0.0.0:50443</span><br><span class="line">grpc_listen_addr: 127.0.0.1:50443</span><br><span class="line"></span><br><span class="line"># Allow the gRPC admin interface to run in INSECURE</span><br><span class="line"># mode. This is not recommended as the traffic will</span><br><span class="line"># be unencrypted. Only enable if you know what you</span><br><span class="line"># are doing.</span><br><span class="line">grpc_allow_insecure: false</span><br><span class="line"></span><br><span class="line"># The Noise section includes specific configuration for the</span><br><span class="line"># TS2021 Noise protocol</span><br><span class="line">noise:</span><br><span class="line">  # The Noise private key is used to encrypt the</span><br><span class="line">  # traffic between headscale and Tailscale clients when</span><br><span class="line">  # using the new Noise-based protocol.</span><br><span class="line">  private_key_path: /var/lib/headscale/noise_private.key</span><br><span class="line"></span><br><span class="line"># List of IP prefixes to allocate tailaddresses from.</span><br><span class="line"># Each prefix consists of either an IPv4 or IPv6 address,</span><br><span class="line"># and the associated prefix length, delimited by a slash.</span><br><span class="line"># It must be within IP ranges supported by the Tailscale</span><br><span class="line"># client - i.e., subnets of 100.64.0.0/10 and fd7a:115c:a1e0::/48.</span><br><span class="line"># See below:</span><br><span class="line"># IPv6: https://github.com/tailscale/tailscale/blob/22ebb25e833264f58d7c3f534a8b166894a89536/net/tsaddr/tsaddr.go#LL81C52-L81C71</span><br><span class="line"># IPv4: https://github.com/tailscale/tailscale/blob/22ebb25e833264f58d7c3f534a8b166894a89536/net/tsaddr/tsaddr.go#L33</span><br><span class="line"># Any other range is NOT supported, and it will cause unexpected issues.</span><br><span class="line">prefixes:</span><br><span class="line">  v6: fd7a:115c:a1e0::/48</span><br><span class="line">  v4: 100.64.0.0/10</span><br><span class="line"></span><br><span class="line">  # Strategy used for allocation of IPs to nodes, available options:</span><br><span class="line">  # - sequential (default): assigns the next free IP from the previous given IP.</span><br><span class="line">  # - random: assigns the next free IP from a pseudo-random IP generator (crypto/rand).</span><br><span class="line">  allocation: sequential</span><br><span class="line"></span><br><span class="line"># DERP is a relay system that Tailscale uses when a direct</span><br><span class="line"># connection cannot be established.</span><br><span class="line"># https://tailscale.com/blog/how-tailscale-works/#encrypted-tcp-relays-derp</span><br><span class="line">#</span><br><span class="line"># headscale needs a list of DERP servers that can be presented</span><br><span class="line"># to the clients.</span><br><span class="line">derp:</span><br><span class="line">  server:</span><br><span class="line">    # If enabled, runs the embedded DERP server and merges it into the rest of the DERP config</span><br><span class="line">    # The Headscale server_url defined above MUST be using https, DERP requires TLS to be in place</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">    # Region ID to use for the embedded DERP server.</span><br><span class="line">    # The local DERP prevails if the region ID collides with other region ID coming from</span><br><span class="line">    # the regular DERP config.</span><br><span class="line">    region_id: 999</span><br><span class="line"></span><br><span class="line">    # Region code and name are displayed in the Tailscale UI to identify a DERP region</span><br><span class="line">    region_code: &quot;headscale&quot;</span><br><span class="line">    region_name: &quot;Headscale Embedded DERP&quot;</span><br><span class="line"></span><br><span class="line">    # Listens over UDP at the configured address for STUN connections - to help with NAT traversal.</span><br><span class="line">    # When the embedded DERP server is enabled stun_listen_addr MUST be defined.</span><br><span class="line">    #</span><br><span class="line">    # For more details on how this works, check this great article: https://tailscale.com/blog/how-tailscale-works/</span><br><span class="line">    stun_listen_addr: &quot;0.0.0.0:3478&quot;</span><br><span class="line"></span><br><span class="line">    # Private key used to encrypt the traffic between headscale DERP</span><br><span class="line">    # and Tailscale clients.</span><br><span class="line">    # The private key file will be autogenerated if it&#x27;s missing.</span><br><span class="line">    #</span><br><span class="line">    private_key_path: /var/lib/headscale/derp_server_private.key</span><br><span class="line"></span><br><span class="line">    # This flag can be used, so the DERP map entry for the embedded DERP server is not written automatically,</span><br><span class="line">    # it enables the creation of your very own DERP map entry using a locally available file with the parameter DERP.paths</span><br><span class="line">    # If you enable the DERP server and set this to false, it is required to add the DERP server to the DERP map using DERP.paths</span><br><span class="line">    automatically_add_embedded_derp_region: true</span><br><span class="line"></span><br><span class="line">    # For better connection stability (especially when using an Exit-Node and DNS is not working),</span><br><span class="line">    # it is possible to optionally add the public IPv4 and IPv6 address to the Derp-Map using:</span><br><span class="line">    ipv4: 1.2.3.4</span><br><span class="line">    ipv6: 2001:db8::1</span><br><span class="line"></span><br><span class="line">  # List of externally available DERP maps encoded in JSON</span><br><span class="line">  urls:</span><br><span class="line">    - https://controlplane.tailscale.com/derpmap/default</span><br><span class="line"></span><br><span class="line">  # Locally available DERP map files encoded in YAML</span><br><span class="line">  #</span><br><span class="line">  # This option is mostly interesting for people hosting</span><br><span class="line">  # their own DERP servers:</span><br><span class="line">  # https://tailscale.com/kb/1118/custom-derp-servers/</span><br><span class="line">  #</span><br><span class="line">  # paths:</span><br><span class="line">  #   - /etc/headscale/derp-example.yaml</span><br><span class="line">  paths: []</span><br><span class="line"></span><br><span class="line">  # If enabled, a worker will be set up to periodically</span><br><span class="line">  # refresh the given sources and update the derpmap</span><br><span class="line">  # will be set up.</span><br><span class="line">  auto_update_enabled: true</span><br><span class="line"></span><br><span class="line">  # How often should we check for DERP updates?</span><br><span class="line">  update_frequency: 24h</span><br><span class="line"></span><br><span class="line"># Disables the automatic check for headscale updates on startup</span><br><span class="line">disable_check_updates: false</span><br><span class="line"></span><br><span class="line"># Time before an inactive ephemeral node is deleted?</span><br><span class="line">ephemeral_node_inactivity_timeout: 30m</span><br><span class="line"></span><br><span class="line">database:</span><br><span class="line">  # Database type. Available options: sqlite, postgres</span><br><span class="line">  # Please note that using Postgres is highly discouraged as it is only supported for legacy reasons.</span><br><span class="line">  # All new development, testing and optimisations are done with SQLite in mind.</span><br><span class="line">  type: sqlite</span><br><span class="line"></span><br><span class="line">  # Enable debug mode. This setting requires the log.level to be set to &quot;debug&quot; or &quot;trace&quot;.</span><br><span class="line">  debug: false</span><br><span class="line"></span><br><span class="line">  # GORM configuration settings.</span><br><span class="line">  gorm:</span><br><span class="line">    # Enable prepared statements.</span><br><span class="line">    prepare_stmt: true</span><br><span class="line"></span><br><span class="line">    # Enable parameterized queries.</span><br><span class="line">    parameterized_queries: true</span><br><span class="line"></span><br><span class="line">    # Skip logging &quot;record not found&quot; errors.</span><br><span class="line">    skip_err_record_not_found: true</span><br><span class="line"></span><br><span class="line">    # Threshold for slow queries in milliseconds.</span><br><span class="line">    slow_threshold: 1000</span><br><span class="line"></span><br><span class="line">  # SQLite config</span><br><span class="line">  sqlite:</span><br><span class="line">    path: /var/lib/headscale/db.sqlite</span><br><span class="line"></span><br><span class="line">    # Enable WAL mode for SQLite. This is recommended for production environments.</span><br><span class="line">    # https://www.sqlite.org/wal.html</span><br><span class="line">    write_ahead_log: true</span><br><span class="line"></span><br><span class="line">  # # Postgres config</span><br><span class="line">  # Please note that using Postgres is highly discouraged as it is only supported for legacy reasons.</span><br><span class="line">  # See database.type for more information.</span><br><span class="line">  # postgres:</span><br><span class="line">  #   # If using a Unix socket to connect to Postgres, set the socket path in the &#x27;host&#x27; field and leave &#x27;port&#x27; blank.</span><br><span class="line">  #   host: localhost</span><br><span class="line">  #   port: 5432</span><br><span class="line">  #   name: headscale</span><br><span class="line">  #   user: foo</span><br><span class="line">  #   pass: bar</span><br><span class="line">  #   max_open_conns: 10</span><br><span class="line">  #   max_idle_conns: 10</span><br><span class="line">  #   conn_max_idle_time_secs: 3600</span><br><span class="line"></span><br><span class="line">  #   # If other &#x27;sslmode&#x27; is required instead of &#x27;require(true)&#x27; and &#x27;disabled(false)&#x27;, set the &#x27;sslmode&#x27; you need</span><br><span class="line">  #   # in the &#x27;ssl&#x27; field. Refers to https://www.postgresql.org/docs/current/libpq-ssl.html Table 34.1.</span><br><span class="line">  #   ssl: false</span><br><span class="line"></span><br><span class="line">### TLS configuration</span><br><span class="line">#</span><br><span class="line">## Let&#x27;s encrypt / ACME</span><br><span class="line">#</span><br><span class="line"># headscale supports automatically requesting and setting up</span><br><span class="line"># TLS for a domain with Let&#x27;s Encrypt.</span><br><span class="line">#</span><br><span class="line"># URL to ACME directory</span><br><span class="line">acme_url: https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line"></span><br><span class="line"># Email to register with ACME provider</span><br><span class="line">acme_email: &quot;&quot;</span><br><span class="line"></span><br><span class="line"># Domain name to request a TLS certificate for:</span><br><span class="line">tls_letsencrypt_hostname: &quot;&quot;</span><br><span class="line"></span><br><span class="line"># Path to store certificates and metadata needed by</span><br><span class="line"># letsencrypt</span><br><span class="line"># For production:</span><br><span class="line">tls_letsencrypt_cache_dir: /var/lib/headscale/cache</span><br><span class="line"></span><br><span class="line"># Type of ACME challenge to use, currently supported types:</span><br><span class="line"># HTTP-01 or TLS-ALPN-01</span><br><span class="line"># See [docs/tls.md](docs/tls.md) for more information</span><br><span class="line">tls_letsencrypt_challenge_type: HTTP-01</span><br><span class="line"># When HTTP-01 challenge is chosen, letsencrypt must set up a</span><br><span class="line"># verification endpoint, and it will be listening on:</span><br><span class="line"># :http = port 80</span><br><span class="line">tls_letsencrypt_listen: &quot;:http&quot;</span><br><span class="line"></span><br><span class="line">## Use already defined certificates:</span><br><span class="line">tls_cert_path: &quot;&quot;</span><br><span class="line">tls_key_path: &quot;&quot;</span><br><span class="line"></span><br><span class="line">log:</span><br><span class="line">  # Output formatting for logs: text or json</span><br><span class="line">  format: text</span><br><span class="line">  level: info</span><br><span class="line"></span><br><span class="line">## Policy</span><br><span class="line"># headscale supports Tailscale&#x27;s ACL policies.</span><br><span class="line"># Please have a look to their KB to better</span><br><span class="line"># understand the concepts: https://tailscale.com/kb/1018/acls/</span><br><span class="line">policy:</span><br><span class="line">  # The mode can be &quot;file&quot; or &quot;database&quot; that defines</span><br><span class="line">  # where the ACL policies are stored and read from.</span><br><span class="line">  mode: file</span><br><span class="line">  # If the mode is set to &quot;file&quot;, the path to a</span><br><span class="line">  # HuJSON file containing ACL policies.</span><br><span class="line">  path: &quot;&quot;</span><br><span class="line"></span><br><span class="line">## DNS</span><br><span class="line">#</span><br><span class="line"># headscale supports Tailscale&#x27;s DNS configuration and MagicDNS.</span><br><span class="line"># Please have a look to their KB to better understand the concepts:</span><br><span class="line">#</span><br><span class="line"># - https://tailscale.com/kb/1054/dns/</span><br><span class="line"># - https://tailscale.com/kb/1081/magicdns/</span><br><span class="line"># - https://tailscale.com/blog/2021-09-private-dns-with-magicdns/</span><br><span class="line">#</span><br><span class="line"># Please note that for the DNS configuration to have any effect,</span><br><span class="line"># clients must have the `--accept-dns=true` option enabled. This is the</span><br><span class="line"># default for the Tailscale client. This option is enabled by default</span><br><span class="line"># in the Tailscale client.</span><br><span class="line">#</span><br><span class="line"># Setting _any_ of the configuration and `--accept-dns=true` on the</span><br><span class="line"># clients will integrate with the DNS manager on the client or</span><br><span class="line"># overwrite /etc/resolv.conf.</span><br><span class="line"># https://tailscale.com/kb/1235/resolv-conf</span><br><span class="line">#</span><br><span class="line"># If you want stop Headscale from managing the DNS configuration</span><br><span class="line"># all the fields under `dns` should be set to empty values.</span><br><span class="line">dns:</span><br><span class="line">  # Whether to use [MagicDNS](https://tailscale.com/kb/1081/magicdns/).</span><br><span class="line">  # Only works if there is at least a nameserver defined.</span><br><span class="line">  magic_dns: true</span><br><span class="line"></span><br><span class="line">  # Defines the base domain to create the hostnames for MagicDNS.</span><br><span class="line">  # This domain _must_ be different from the server_url domain.</span><br><span class="line">  # `base_domain` must be a FQDN, without the trailing dot.</span><br><span class="line">  # The FQDN of the hosts will be</span><br><span class="line">  # `hostname.base_domain` (e.g., _myhost.example.com_).</span><br><span class="line">  base_domain: intra.example.com</span><br><span class="line"></span><br><span class="line">  # List of DNS servers to expose to clients.</span><br><span class="line">  nameservers:</span><br><span class="line">    global:</span><br><span class="line">      - 1.1.1.1</span><br><span class="line">      - 1.0.0.1</span><br><span class="line">      - 2606:4700:4700::1111</span><br><span class="line">      - 2606:4700:4700::1001</span><br><span class="line"></span><br><span class="line">      # NextDNS (see https://tailscale.com/kb/1218/nextdns/).</span><br><span class="line">      # &quot;abc123&quot; is example NextDNS ID, replace with yours.</span><br><span class="line">      # - https://dns.nextdns.io/abc123</span><br><span class="line"></span><br><span class="line">    # Split DNS (see https://tailscale.com/kb/1054/dns/),</span><br><span class="line">    # a map of domains and which DNS server to use for each.</span><br><span class="line">    split:</span><br><span class="line">      &#123;&#125;</span><br><span class="line">      # foo.bar.com:</span><br><span class="line">      #   - 1.1.1.1</span><br><span class="line">      # darp.headscale.net:</span><br><span class="line">      #   - 1.1.1.1</span><br><span class="line">      #   - 8.8.8.8</span><br><span class="line"></span><br><span class="line">  # Set custom DNS search domains. With MagicDNS enabled,</span><br><span class="line">  # your tailnet base_domain is always the first search domain.</span><br><span class="line">  search_domains: []</span><br><span class="line"></span><br><span class="line">  # Extra DNS records</span><br><span class="line">  # so far only A-records are supported (on the tailscale side)</span><br><span class="line">  # See https://github.com/juanfont/headscale/blob/main/docs/dns-records.md#Limitations</span><br><span class="line">  extra_records: []</span><br><span class="line">  #   - name: &quot;grafana.myvpn.example.com&quot;</span><br><span class="line">  #     type: &quot;A&quot;</span><br><span class="line">  #     value: &quot;100.64.0.3&quot;</span><br><span class="line">  #</span><br><span class="line">  #   # you can also put it in one line</span><br><span class="line">  #   - &#123; name: &quot;prometheus.myvpn.example.com&quot;, type: &quot;A&quot;, value: &quot;100.64.0.3&quot; &#125;</span><br><span class="line"></span><br><span class="line">  # DEPRECATED</span><br><span class="line">  # Use the username as part of the DNS name for nodes, with this option enabled:</span><br><span class="line">  # node1.username.example.com</span><br><span class="line">  # while when this is disabled:</span><br><span class="line">  # node1.example.com</span><br><span class="line">  # This is a legacy option as Headscale has have this wrongly implemented</span><br><span class="line">  # while in upstream Tailscale, the username is not included.</span><br><span class="line">  use_username_in_magic_dns: false</span><br><span class="line"></span><br><span class="line"># Unix socket used for the CLI to connect without authentication</span><br><span class="line"># Note: for production you will want to set this to something like:</span><br><span class="line">unix_socket: /var/run/headscale/headscale.sock</span><br><span class="line">unix_socket_permission: &quot;0770&quot;</span><br><span class="line">#</span><br><span class="line"># headscale supports experimental OpenID connect support,</span><br><span class="line"># it is still being tested and might have some bugs, please</span><br><span class="line"># help us test it.</span><br><span class="line"># OpenID Connect</span><br><span class="line"># oidc:</span><br><span class="line">#   only_start_if_oidc_is_available: true</span><br><span class="line">#   issuer: &quot;https://your-oidc.issuer.com/path&quot;</span><br><span class="line">#   client_id: &quot;your-oidc-client-id&quot;</span><br><span class="line">#   client_secret: &quot;your-oidc-client-secret&quot;</span><br><span class="line">#   # Alternatively, set `client_secret_path` to read the secret from the file.</span><br><span class="line">#   # It resolves environment variables, making integration to systemd&#x27;s</span><br><span class="line">#   # `LoadCredential` straightforward:</span><br><span class="line">#   client_secret_path: &quot;$&#123;CREDENTIALS_DIRECTORY&#125;/oidc_client_secret&quot;</span><br><span class="line">#   # client_secret and client_secret_path are mutually exclusive.</span><br><span class="line">#</span><br><span class="line">#   # The amount of time from a node is authenticated with OpenID until it</span><br><span class="line">#   # expires and needs to reauthenticate.</span><br><span class="line">#   # Setting the value to &quot;0&quot; will mean no expiry.</span><br><span class="line">#   expiry: 180d</span><br><span class="line">#</span><br><span class="line">#   # Use the expiry from the token received from OpenID when the user logged</span><br><span class="line">#   # in, this will typically lead to frequent need to reauthenticate and should</span><br><span class="line">#   # only been enabled if you know what you are doing.</span><br><span class="line">#   # Note: enabling this will cause `oidc.expiry` to be ignored.</span><br><span class="line">#   use_expiry_from_token: false</span><br><span class="line">#</span><br><span class="line">#   # Customize the scopes used in the OIDC flow, defaults to &quot;openid&quot;, &quot;profile&quot; and &quot;email&quot; and add custom query</span><br><span class="line">#   # parameters to the Authorize Endpoint request. Scopes default to &quot;openid&quot;, &quot;profile&quot; and &quot;email&quot;.</span><br><span class="line">#</span><br><span class="line">#   scope: [&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;, &quot;custom&quot;]</span><br><span class="line">#   extra_params:</span><br><span class="line">#     domain_hint: example.com</span><br><span class="line">#</span><br><span class="line">#   # List allowed principal domains and/or users. If an authenticated user&#x27;s domain is not in this list, the</span><br><span class="line">#   # authentication request will be rejected.</span><br><span class="line">#</span><br><span class="line">#   allowed_domains:</span><br><span class="line">#     - example.com</span><br><span class="line">#   # Note: Groups from keycloak have a leading &#x27;/&#x27;</span><br><span class="line">#   allowed_groups:</span><br><span class="line">#     - /headscale</span><br><span class="line">#   allowed_users:</span><br><span class="line">#     - alice@example.com</span><br><span class="line">#</span><br><span class="line">#   # If `strip_email_domain` is set to `true`, the domain part of the username email address will be removed.</span><br><span class="line">#   # This will transform `first-name.last-name@example.com` to the user `first-name.last-name`</span><br><span class="line">#   # If `strip_email_domain` is set to `false` the domain part will NOT be removed resulting to the following</span><br><span class="line">#   user: `first-name.last-name.example.com`</span><br><span class="line">#</span><br><span class="line">#   strip_email_domain: true</span><br><span class="line"></span><br><span class="line"># Logtail configuration</span><br><span class="line"># Logtail is Tailscales logging and auditing infrastructure, it allows the control panel</span><br><span class="line"># to instruct tailscale nodes to log their activity to a remote server.</span><br><span class="line">logtail:</span><br><span class="line">  # Enable logtail for this headscales clients.</span><br><span class="line">  # As there is currently no support for overriding the log server in headscale, this is</span><br><span class="line">  # disabled by default. Enabling this will make your clients send logs to Tailscale Inc.</span><br><span class="line">  enabled: false</span><br><span class="line"></span><br><span class="line"># Enabling this option makes devices prefer a random port for WireGuard traffic over the</span><br><span class="line"># default static port 41641. This option is intended as a workaround for some buggy</span><br><span class="line"># firewall devices. See https://tailscale.com/kb/1181/firewalls/ for more information.</span><br><span class="line">randomize_client_port: true</span><br></pre></td></tr></table></figure>



      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<!-- <div id="bottom-donation-section"> -->
<!-- <span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick"  style="background: url(/images/logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_line_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.addtoany.com/add_to/line?linkurl=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/support/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span> -->
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/support">点我 赞助 作者</a>
</div>
-->
<!-- </div> -->
<!-- <div class="well"> -->
  <!--
  原创文章，转载请注明： 转载自<a target="_blank" rel="noopener" href="http://52binge.github.io"> Blair Chan's Blog</a>，作者：
  <a href="/about">Blair Chan</a> <br>
  -->
  <!-- 本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。 -->
<!-- </div> -->
 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tailscale-%E4%BB%8B%E7%BB%8D"><span class="toc-text">Tailscale 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%83%A8%E7%BD%B2"><span class="toc-text">服务端部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="toc-text">客户端连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E5%85%A8%E9%87%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text">附录：全量服务端配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose-yaml"><span class="toc-text">.&#x2F;docker-compose.yaml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caddyfile"><span class="toc-text">.&#x2F;Caddyfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#config-config-yaml"><span class="toc-text">.&#x2F;config&#x2F;config.yaml</span></a></li></ol></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/intrusion-investigation/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">炼丹炉被黑始末 (a.k.a. 这下服务器变回转寿司了，最美味的一集)&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 Libre Liu&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a target="_blank" rel="noopener" href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true,
    },
    options: {
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
  };
</script>
<script type="text/javascript" id="MathJax-script" src="/js/mathjax/tex-chtml.js">
</script>

    

<script src="/js/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>
