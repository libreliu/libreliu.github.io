<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>论文阅读 | 数据驱动的 PRT - libreliu&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文省略了一大堆细节，详情参见论文。 TODO: 整理清楚各个维数，因为原论文也不甚详细； 更新后的版本会放到 这里，如果有。  Recap: Precomputed Radiance Transfer 本节主要参考GAMES 202 - 高质量实时渲染课程的 Lecture 6 和 Lecture 7  考虑渲染方程 $$ L({\bf o}) &#x3D; \int_{\mathcal{H}^2} L">
<meta property="og:type" content="article">
<meta property="og:title" content="论文阅读 | 数据驱动的 PRT">
<meta property="og:url" content="https://blog.libreliu.info/paper-reading/data-driven-prt/">
<meta property="og:site_name" content="libreliu&#39;s blog">
<meta property="og:description" content="本文省略了一大堆细节，详情参见论文。 TODO: 整理清楚各个维数，因为原论文也不甚详细； 更新后的版本会放到 这里，如果有。  Recap: Precomputed Radiance Transfer 本节主要参考GAMES 202 - 高质量实时渲染课程的 Lecture 6 和 Lecture 7  考虑渲染方程 $$ L({\bf o}) &#x3D; \int_{\mathcal{H}^2} L">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-12-17T16:00:00.000Z">
<meta property="article:modified_time" content="2022-12-17T16:00:00.000Z">
<meta property="article:author" content="Libre Liu">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/logo.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="libreliu's blog" type="application/atom+xml">
</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/paper-summary">Paper Reading</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.libreliu.info"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="paper-reading-paper-reading/data-driven-prt" class="article article-type-paper-reading" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      论文阅读 | 数据驱动的 PRT
      <small class=article-detail-date-index>&nbsp; 2022-12-18</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/paper-reading/data-driven-prt/" class="article-date">
  <time datetime="2022-12-17T16:00:00.000Z" itemprop="datePublished">2022-12-18</time>
</a>-->
      <!-- 
--><!-- by blair 160724 -->
      <!-- by blair
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
          <p>论文标题：A Data-Driven Paradigm for Precomputed Radiance Transfer</p>
          <p>论文来源：PACMCGIT 2022</p>
          <p>论文作者：Laurent Belcour, Thomas Deliot, Wilhem Barbier, Cyril Soler</p>
          <p><a target="_blank" rel="noopener" href='https://dl.acm.org/doi/10.1145/3543864'>论文链接</a></p>
        </blockquote>
      
      
      
        <blockquote>
<p>本文省略了一大堆细节，详情参见论文。</p>
<p>TODO: 整理清楚各个维数，因为原论文也不甚详细；</p>
<p>更新后的版本会放到 <a href="https://blog.libreliu.info/paper-reading/data-driven-prt/">这里</a>，如果有。</p>
</blockquote>
<h2 id="Recap-Precomputed-Radiance-Transfer"><a href="#Recap-Precomputed-Radiance-Transfer" class="headerlink" title="Recap: Precomputed Radiance Transfer"></a>Recap: Precomputed Radiance Transfer</h2><blockquote>
<p>本节主要参考<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YK4y1T7yY">GAMES 202 - 高质量实时渲染</a>课程的 Lecture 6 和 Lecture 7</p>
</blockquote>
<p>考虑渲染方程</p>
$$
L({\bf o}) = \int_{\mathcal{H}^2} L({\bf i}) \rho({\bf i}, {\bf o}) V({\bf i}) \max(0, {\bf n} \cdot {\bf i}) d {\bf i}
$$

<p>其中</p>
<ul>
<li>$ {\bf i}, {\bf o} $ 为入射和出射方向</li>
<li>$ L({\bf i}), L({\bf o}) $ 为入射和出射 radiance<ul>
<li>此处<strong>省略了</strong>作为参数的 shading point 位置 $ \bf x $，下同</li>
</ul>
</li>
<li>$ \rho $ 为 BRDF 函数</li>
<li>$ V $ 为 Visibility 项</li>
</ul>
<p>将 $ L({\bf i}) $ 项用级数的有限项进行近似，即</p>
$$
L({\bf i}) \approx \sum_{i=1}^{n} l_i B_i({\bf i})
$$

<blockquote>
<p>其中 $ B_i: S^2 \to \mathbb{R} $ 为基函数</p>
</blockquote>
<p>带入得到</p>
$$
\begin{aligned}
L({\bf o}) &= \int_{\mathcal{H}^2} L({\bf i}) \rho({\bf i}, {\bf o}) V({\bf i}) \max(0, {\bf n} \cdot {\bf i}) d {\bf i} \\
&\approx \sum_i l_i \int_{\mathcal{H}^2} B_i({\bf i}) \rho({\bf i}, {\bf o}) V({\bf i}) \max(0, {\bf n} \cdot {\bf i}) d {\bf i} \\
&= \sum_i l_i T_i({\bf o})
\end{aligned}
$$

<p>这里把上面的积分 (“Light transport term”) 记作 $ T_i $.</p>
<p>这里继续进行展开</p>
$$
T_i({\bf o}) \approx \sum_{j=1}^{m} t_{ij} B_j({\bf o})
$$

<p>所以我们得到</p>
$$
\begin{aligned}
L({\bf o}) &\approx \sum_i l_i T_i({\bf o}) \\
&\approx \sum_i l_i \left( \sum_j t_{ij} B_j({\bf o}) \right) \\
&\approx \sum_j \left( \sum_i l_i t_{ij} \right) B_j({\bf o}) \\
\end{aligned}
$$

<p>也就是说</p>
$$
L({\bf o}) 
\approx 
\begin{bmatrix}
l_1 & ... & l_n
\end{bmatrix}
\begin{bmatrix}
t_{11} & ... & t_{1m} \\
\vdots & & \vdots \\
t_{n1} & ... & t_{nm}
\end{bmatrix}
\begin{bmatrix}
B_1({\bf o}) \\ \vdots \\ B_m({\bf o})
\end{bmatrix}
$$

<p>那么，PRT 的框架就大致如下</p>
<ol>
<li><p>预计算</p>
<ul>
<li>对每个可能的 shading point $ {\bf x} $<ul>
<li>计算该物体的环境光在基函数下对应的系数 $ l_i $</li>
<li>计算该物体光传输展开系数 $ t_{ij} $</li>
</ul>
</li>
</ul>
<blockquote>
<p>当然，对于 Image based lighting，一般认为 $ L({\bf i}, {\bf x}) \approx L({\bf i}) $，那某些东西就不需要 per-shading point 存储</p>
</blockquote>
</li>
<li><p>运行时</p>
<ul>
<li>根据视角 $ {\bf o} $ 和位置 $ {\bf x} $ 来读取对应的向量并计算</li>
</ul>
</li>
</ol>
<blockquote>
<p>对于 Diffuse 物体，$ \rho({\bf i}, {\bf o}) $ 是常数，所以不需要继续展开 $ T_i $ 项</p>
</blockquote>
<blockquote>
<p>Remarks from paper: PRT methods bake the transport matrix using implicit light sources defined by the illumination basis.<br>Those light sources shade the asset with positive and negative radiance values. Hence, a dedicated light transport algorithm is used for them.</p>
</blockquote>
<h2 id="本文思路"><a href="#本文思路" class="headerlink" title="本文思路"></a>本文思路</h2><p>本文的框架只考虑<strong>漫反射</strong>，虽然结果上对于不是特别 Glossy 的材质应该都可以应用。</p>
<p>框架上的思路就是</p>
<ul>
<li>间接光 $ L_i({\bf x}; t) $ 和直接光 $ L_d({\bf i}, {\bf x}; t) $ 之间存在线性关系</li>
<li>框架：<ul>
<li>将 $ {\bf x} $ 和 $ i \times t $ 所在空间分别做一离散化，得到 $ I &#x3D; MD $<ul>
<li>相当于挑了一组基，每个基内部由同一个光照条件下各个位置的 $ L_d $ 组成</li>
</ul>
</li>
<li>对于给定的光照条件 $ x $ （各个位置 $ L_d $的值构成的列向量） ，如何求解 $ L_i $ ？<ul>
<li>首先把 $ x $ 分解到该 $ D $ 基下，得到系数向量 $ c &#x3D; (D^T D)^{-1} D^T x $</li>
<li>每个 $ D $ 基我们都存储有对应的输出，所以结果 $ y &#x3D; Mx &#x3D; I(D^T D)^{-1} D^T x $</li>
</ul>
</li>
</ul>
</li>
<li>近似：<ul>
<li>对 $ I $ 进行 SVD 分解并保留前 $ k $ 项，得到近似矩阵 $ I &#x3D; U \Sigma V^T \approx U_n \Sigma_n V_n^T $</li>
<li>$ y \approx U_n (\Sigma_n V_n^T) (D^T D)^{-1} D^T x $<ul>
<li>let $ M_n &#x3D; (\Sigma_n V_n^T) (D^T D)^{-1} D^T $</li>
</ul>
</li>
<li>存储 $ U_n $ 和 $ M_n $</li>
</ul>
</li>
<li>运行时：<ul>
<li>用 G-Buffer 得到 $ \mathcal{X}_D $ 空间上的各 $ L_d({\bf i}, {\bf x}; t) $ 的值</li>
<li>计算 $ y &#x3D; U_n M_n x $ 的值</li>
</ul>
</li>
</ul>
<h3 id="估计光传输矩阵"><a href="#估计光传输矩阵" class="headerlink" title="估计光传输矩阵"></a>估计光传输矩阵</h3><p>给定<strong>环境光</strong>条件 $ t \in \mathcal T $，那么在物体表面 $ {\bf x} $ 处，<strong>漫反射</strong>光传输方程的形式如下</p>
$$
L_i({\bf x}; t) = \frac{1}{2 \pi}\int_{\mathcal{H}^2} L_d({\bf i}, {\bf x}; t) V({\bf i}, {\bf x}) \max(0, {\bf n} \cdot {\bf i}) d {\bf i}
$$

<p>其中，$ L_i({\bf x}; t) $ 被称为间接光， $ L_d({\bf i}, {\bf x}; t) $ 被称为直接光</p>
<blockquote>
<p>$ L_d({\bf i}, {\bf x}; t) $ 不考虑环境和物体 inter-reflection; 推导中可以先忽略，虽然实际上对于有 inter-transmission 的情况应该也是可以应用的</p>
</blockquote>
<p>现在将 $ {\bf x} $ 和 $ i \times t $ 所在空间分别做一离散化，得到 $ \mathcal{X}_D $ 和 $ \mathcal{T}_D $ 两有限维空间，那么在这两个空间上， $ L_d $ 和 $ L_i $ 都可以表示为矩阵形式，这里规定每一列的元素在同一个环境光条件 $ {\bf i}, t $ 上。</p>
<blockquote>
<p>比如说，都在环境光为某点光源照射的情况； $ L_d({\bf i}, {\bf x}; t) $ 的 $ {\bf i} $ 一般意义上是依赖 $ t $ 的</p>
</blockquote>
<p>记得到的两个矩阵为 $ D $ 和 $ I $，则</p>
$$
I_k = f(D_k) \quad \forall k \in [0, |\mathcal{T}_D|]
$$

<p>从前面可以看到，这里的 $f$ 是线性算子 (<em>是嘛？</em>)，所以</p>
$$
I = MD
$$

<p>又假设我们离散 $ \mathcal T $ 空间离散的很好，那么对任意的环境光条件，<strong>直接光向量</strong> $ x $ 都可以表示成 $ D $ 的线性组合，满足</p>
$$
x = Dc
$$

<p>左右乘 $ M $ 得到</p>
$$
Mx = MDc = Ic
$$

<p>也就是说 $x$ 产生的间接光照可以用 $I$ 中列向量的线性组合来表示</p>
<p>因为 $ x &#x3D; Dc $，假设 $ D^T D $ 可逆，那么用左逆得到</p>
$$
c = (D^T D)^{-1} D^T x
$$

<p>那么</p>
$$
y = Mx = Ic = I (D^T D)^{-1} D^T x
$$

<p>这样就给出了<strong>任意直接光经过光传输</strong>的结果</p>
<h3 id="间接光基函数"><a href="#间接光基函数" class="headerlink" title="间接光基函数"></a>间接光基函数</h3><p>我们认为，间接光所对应的空间的秩比较低，所以用 SVD 分解然后保留前 $ n $ 项</p>
$$
I = U \Sigma V^T \approx U_n \Sigma_n V_n^T = U_n C_n
$$

<p>其中记 $ C_n &#x3D; \Sigma_n V_n^T $</p>
<p>带回去，得到任意直接光组合经过光传输方程的近似结果</p>
$$
\begin{aligned}
y &\approx U_n C_n (D^T D)^{-1} D^T x \\
&\approx U_n M_n x
\end{aligned}
$$

<p>其中 $ M_n &#x3D; C_n (D^T D)^{-1} D^T $</p>
<h3 id="直接光编码"><a href="#直接光编码" class="headerlink" title="直接光编码"></a>直接光编码</h3><p>如果有需要的话，可以考虑 SH 基函数，详见文章</p>
<h2 id="对比经典-PRT"><a href="#对比经典-PRT" class="headerlink" title="对比经典 PRT"></a>对比经典 PRT</h2><p>First, because classical PRT restricts the frequency content of the incoming lighting, we can see that the directional light leaks behind the object. Our method <strong>does not restrict the frequency content of incoming light</strong> but rather <strong>the space of possible indirect illumination</strong>.  Hence, we can better reproduce such lighting scenario. </p>
<p>Furthermore, classical PRT is performed on the vertices of the asset. This can cause interpolation artifacts when the asset is poorly tessellated, and it also links performance to the vertex count. Since we rely on a <strong>meshless approach</strong>, we are free of issues.</p>
<h2 id="局限"><a href="#局限" class="headerlink" title="局限"></a>局限</h2><p><strong>Sparse Illumination Measurement</strong>. As shown in Section 3.3, the sampling of the measurement points is linked to the achievable lighting dimensionality. Thus, it needs to be sufficiently dense to reproduce the space of observable lighting configurations. It follows that a lighting scenario mixing many light types might require a denser sampling. </p>
<p><strong>No Directionality</strong>. We reconstruct a diffuse appearance when reconstructing indirect illumination. However, since our method does not depend on the encoding of the measured indirect illumination, it can be extended to reconstruct glossy appearances e.g. directional distributions using directional sampling or any basis such as Spherical Harmonics. However, our method is likely to be restricted to low frequency gloss here and will not work to render specular reflections. </p>
<p><strong>Large Assets</strong>. Our solution is not designed to handle assets such as levels in a game. Because we handle light transport globally and reduce it with a handful of basis functions, we cannot reconstruct the interconnected interiors or large environments in which the combinatorics of possible illumination is large. For such case, our method would require to be extended to handle modular transfer between disjoint transport solutions (Similar to Loos et al. [2011]).</p>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<!-- <div id="bottom-donation-section"> -->
<!-- <span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick"  style="background: url(/images/logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_line_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.addtoany.com/add_to/line?linkurl=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/support/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span> -->
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/support">点我 赞助 作者</a>
</div>
-->
<!-- </div> -->
<!-- <div class="well"> -->
  <!--
  原创文章，转载请注明： 转载自<a target="_blank" rel="noopener" href="http://52binge.github.io"> Blair Chan's Blog</a>，作者：
  <a href="/about">Blair Chan</a> <br>
  -->
  <!-- 本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。 -->
<!-- </div> -->
 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Recap-Precomputed-Radiance-Transfer"><span class="toc-text">Recap: Precomputed Radiance Transfer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E6%80%9D%E8%B7%AF"><span class="toc-text">本文思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%B0%E8%AE%A1%E5%85%89%E4%BC%A0%E8%BE%93%E7%9F%A9%E9%98%B5"><span class="toc-text">估计光传输矩阵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%B4%E6%8E%A5%E5%85%89%E5%9F%BA%E5%87%BD%E6%95%B0"><span class="toc-text">间接光基函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%85%89%E7%BC%96%E7%A0%81"><span class="toc-text">直接光编码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E7%BB%8F%E5%85%B8-PRT"><span class="toc-text">对比经典 PRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%99%90"><span class="toc-text">局限</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/example-vulkan-app-flow/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          一个示例 Vulkan 程序的全流程记录
        
      </div>
    </a>
  
  
    <a href="/paper-reading/continuous-mis/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">论文阅读 | 连续多重重要性采样&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Libre Liu&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a target="_blank" rel="noopener" href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true,
    },
    options: {
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
  };
</script>
<script type="text/javascript" id="MathJax-script" src="/js/mathjax/tex-chtml.js">
</script>

    

<script src="/js/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>
